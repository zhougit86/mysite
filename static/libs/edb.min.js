(function(e){"use strict";var t=e._iu_.fastDom;var a=e.util;var r=e.event;var n=e.dom;var u=e.canvas;var l=e.math;var i=e.util.each;var o=e.dom.get;var v=e.dom.gets;e.extend(e.Defaults,{EDB_ATTR_MODEL:"ze-model",EDB_ATTR_SHOW:"ze-show",EDB_ATTR_HIDE:"ze-hide",EDB_ATTR_VISIBLE_STYLE:"ze-visible_style",EDB_ATTR_DISABLED:"ze-disabled",EDB_ATTR_READONLY:"ze-readonly"});var s={getAttr:function(t,a){var r=a+"_attr";if(t.hasOwnProperty(r)){return t[r]}return e.Defaults["EDB_ATTR_"+a.toUpperCase()]},setElementValue:function(e,t,a,r,n,u,l){if(u){n.apply(l,[e,a,t,r])}else{n(e,a)}},getElementValue:function(e,t,a,r,n){if(r){return a.apply(n,[e,t])}else{return a(e)}},getRoot:function(e){return e||document.body},callCondition:function(e){return new Function("return "+e).apply({},[])}};var g={EDB_MODEL_VALUE:"__ze-model-v",setValue:function(e,r,u){var l=r||{};var o=u||{};var v=o.deep!==false;var c=s.getAttr(o,"model");var d=o.setValue;var h=o.context;var V=true;if(!a.isFunction(d)){d=t.setValue;V=false}e=s.getRoot(e);var p=n.children(e,"["+c+"]",true);i(p,function(e){var r=t.getAttr(e,c);if(r){var n=a.getObjectValue(l,r,v);if(n==null){n=""}s.setElementValue(e,r,n,l,d,V,h);e[g.EDB_MODEL_VALUE]=n}});if(o.update!==false){f.update(e,l,o)}},getValue:function(e,r){var u=r||{};var l=u.deep!==false;var o=s.getAttr(u,"model");var v=s.getAttr(u,"readonly");var g=u.getValue;var f=u.context;var c=true;if(!a.isFunction(g)){g=t.getValue;c=false}e=s.getRoot(e);var d=n.children(e,"["+o+"]",true);var h={};i(d,function(e){if(!e.hasAttribute(v)||t.getAttr(e,v)!=="false"&&t.getAttr(e,v)!==""){var r=t.getAttr(e,o);if(r){var n=s.getElementValue(e,r,g,c,f);a.setObjectValue(h,r,n,l)}}});return h},clearValue:function(e,t){g.setValue(e,{},t)},hasChange:function(e,r){var u=r||{};var l=s.getAttr(u,"model");var o=u.getValue;var v=u.context;var f=true;if(!a.isFunction(o)){o=t.getValue;f=false}e=s.getRoot(e);var c=n.children(e,"["+l+"]",true);var d=false;i(c,function(e){var a=t.getAttr(e,a);var r=s.getElementValue(e,a,o,f,v);var n=e[g.EDB_MODEL_VALUE];if(r!=n){d=true;return false}});return d},getChange:function(e,r){var u=r||{};var l=s.getAttr(u,"model");var o=u.getValue;var v=u.context;var f=true;if(!a.isFunction(o)){o=t.getValue;f=false}e=s.getRoot(e);var c=n.children(e,"["+l+"]",true);var d=[];i(c,function(e){var a=t.getAttr(e,a);var r=s.getElementValue(e,a,o,f,v);var n=e[g.EDB_MODEL_VALUE];if(r!=n){d.push({source:e,value:r,property:a,oldValue:n,newValue:r})}});return d}};var f={update:function(e,t,a){f.updateDisable(e,t,a);f.updateVisible(e,t,a)},updateVisible:function(e,a,r){var u=a||{};var l=r||{};var i=l.deep!==false;e=s.getRoot(e);var o=s.getAttr(l,"visible_style");var v=s.getAttr(l,"show");f.__update(e,v,u,i,function(e,a){var r=t.getAttr(e,o)==="visibility";if(a===true){n.show(e,r)}else{n.hide(e,r)}});v=s.getAttr(l,"hide");f.__update(e,v,u,i,function(e,a){var r=t.getAttr(e,o)==="visibility";if(a===true){n.hide(e,r)}else{n.show(e,r)}})},updateDisable:function(e,t,a){var r=t||{};var u=a||{};var l=u.deep!==false;e=s.getRoot(e);var i=s.getAttr(u,"disabled");f.__update(e,i,r,l,function(e,t){if(t===true){n.disable(e)}else{n.enable(e)}})},__update:function(e,r,u,l,o){var v=n.children(e,"["+r+"]",true);i(v,function(e){var n=t.getAttr(e,r);if(n){var i=n.replace(/\[[^\]]*\]/g,function(e){var t=e.substr(1,e.length-2);var r=a.getObjectValue(u,t,l);if(a.isString(r)&&(!r.startsWith("'")&&!r.startsWith('"'))){r="'"+r+"'"}return r||"''"});var v=s.callCondition(i);o(e,v)}})}};var c={updateOnChange:function(e,t){e=s.getRoot(e);c.onchange(e,function(){f.update(e,g.getValue(e,t),t)},null,t)},onchange:function(e,t,u,l){if(a.isFunction(t)){var i=l||{};var o=s.getAttr(i,"model");e=s.getRoot(e);r.onchange(n.children(e,"["+o+"]",true),t,u);i=null}},offchange:function(e,t,u,l){if(!a.isFunction(t)){return}var i=l||{};var o=s.getAttr(i,"model");e=s.getRoot(e);r.off(n.children(e,"["+o+"]",true),"change",t,u);i=null}};e.ext.edb={setValue:g.setValue,getValue:g.getValue,clearValue:g.clearValue,getChange:g.getChange,hasChange:g.hasChange,update:f.update,updateDisable:f.updateDisable,updateVisible:f.updateVisible,onchange:c.onchange,offchange:c.offchange,updateOnChange:c.updateOnChange}})(z);